<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>基金实时估值监控</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .up { color: #ef4444; } /* 红涨 */
        .down { color: #22c55e; } /* 绿跌 */
    </style>
</head>
<body class="bg-gray-100 p-4 md:p-10">
    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-md overflow-hidden p-6">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold text-gray-800">基金实时估值盘中监控</h1>
            <button onclick="fetchAll()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded shadow transition">手动刷新</button>
        </div>
        
        <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="border-b text-gray-600 text-sm">
                        <th class="py-3 px-2">基金代码</th>
                        <th class="py-3 px-2">基金名称</th>
                        <th class="py-3 px-2">单位净值</th>
                        <th class="py-3 px-2">估值</th>
                        <th class="py-3 px-2">估值涨幅</th>
                        <th class="py-3 px-2 text-right">更新时间</th>
                    </tr>
                </thead>
                <tbody id="fund-table">
                    </tbody>
            </table>
        </div>
        <p class="text-xs text-gray-400 mt-6 text-center">数据来源：天天基金估值接口 | 仅供参考，不作为投资建议</p>
    </div>

    <script>
        // 你关注的基金列表
        const fundList = ['005562', '000217', '015790', '161725']; 
        const results = {};

        // JSONP 回调函数
        window.jsonpgz = function(data) {
            results[data.fundcode] = data;
            renderTable();
        };

        function fetchFund(code) {
            const script = document.createElement('script');
            // 添加随机数防止缓存
            script.src = `https://fundgz.1234567.com.cn/js/${code}.js?rt=${Date.now()}`;
            document.body.appendChild(script);
            document.body.removeChild(script); // 载入后即刻移除
        }

        function fetchAll() {
            fundList.forEach(code => fetchFund(code));
        }

        function renderTable() {
            const tbody = document.getElementById('fund-table');
            tbody.innerHTML = '';
            
            fundList.forEach(code => {
                const data = results[code];
                if (!data) return;

                const isUp = parseFloat(data.gszzl) >= 0;
                const row = `
                    <tr class="border-b hover:bg-gray-50 text-sm">
                        <td class="py-4 px-2 font-mono text-gray-500">${data.fundcode}</td>
                        <td class="py-4 px-2 font-medium">${data.name}</td>
                        <td class="py-4 px-2 text-gray-600">${data.dwjz}</td>
                        <td class="py-4 px-2 font-bold ${isUp ? 'up' : 'down'}">${data.gsz}</td>
                        <td class="py-4 px-2 font-bold ${isUp ? 'up' : 'down'}">${isUp ? '+' : ''}${data.gszzl}%</td>
                        <td class="py-4 px-2 text-right text-gray-400 text-xs">${data.gztime}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        // 初始化加载
        fetchAll();
        // 每 60 秒自动刷新一次
        setInterval(fetchAll, 60000);
    </script>
</body>
</html>
